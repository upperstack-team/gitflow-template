#!/bin/sh

branch=$(git rev-parse --abbrev-ref HEAD)

# ğŸš« Bloqueia push direto na main
if [ "$branch" = "main" ]; then
  echo "ğŸš« Push direto na branch 'main' Ã© proibido."
  echo "ğŸ‘‰ Crie um pull request para 'main'."
  exit 1
fi

# ğŸ” Protege develop (exceto no primeiro push)
if [ "$branch" = "develop" ]; then
  exists=$(git ls-remote --heads origin develop)
  if [ -z "$exists" ]; then
    echo "ğŸŸ¢ Primeiro push da branch 'develop' permitido."
  else
    echo "ğŸš« Push direto na branch 'develop' Ã© proibido."
    echo "ğŸ‘‰ Crie um pull request para 'develop'."
    exit 1
  fi
fi

# âŒ ValidaÃ§Ã£o de nome da branch (Git Flow)
if ! echo "$branch" | grep -Eq "^(feature|bugfix|hotfix|release|chore)/[a-z0-9._-]+$"; then
  echo "âŒ Nome de branch invÃ¡lido: '$branch'"
  echo "âœ… Use prefixos como: feature/, hotfix/, chore/, release/"
  exit 1
fi

exit 0
